<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The "Stands For" Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Patrick+Hand&display=swap" rel="stylesheet">
    
    <!-- KaTeX for Math Rendering (Fixed Imports) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    
    <style>
        body {
            font-family: 'Patrick Hand', cursive;
            background-color: #f0f9ff;
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .title-font {
            font-family: 'Fredoka One', cursive;
        }
        .wiggle:hover {
            animation: wiggle 0.5s ease-in-out infinite;
        }
        @keyframes wiggle {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }
        .pop-in {
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            opacity: 0;
            transform: scale(0.5);
        }
        @keyframes popIn {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        .shimmer {
            background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer {
            0% { background-position: -150% 0; }
            100% { background-position: 150% 0; }
        }
        /* Math Box Specifics */
        .katex-display { margin: 0; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-12 px-4 text-slate-800">

    <!-- Header -->
    <header class="text-center mb-10">
        <h1 class="title-font text-5xl md:text-6xl text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 mb-2 drop-shadow-sm">
            Stands For Generator
        </h1>
        <p class="text-xl text-slate-500">Uncover the <i>totally real</i> hidden meaning behind any word.</p>
    </header>

    <!-- Main Card -->
    <div class="w-full max-w-lg bg-white rounded-3xl shadow-[8px_8px_0px_0px_rgba(0,0,0,0.1)] border-4 border-slate-800 p-6 md:p-8 relative overflow-hidden">
        
        <!-- Decorative blob -->
        <div class="absolute -top-10 -right-10 w-32 h-32 bg-yellow-200 rounded-full opacity-50 pointer-events-none"></div>
        <div class="absolute -bottom-10 -left-10 w-24 h-24 bg-pink-200 rounded-full opacity-50 pointer-events-none"></div>

        <!-- Input Section -->
        <div class="relative z-10 flex flex-col gap-4">
            <label for="wordInput" class="sr-only">Enter a word</label>
            <input 
                type="text" 
                id="wordInput" 
                placeholder="Type a name or word..." 
                class="w-full bg-slate-100 border-2 border-slate-300 rounded-xl px-4 py-4 text-2xl text-center focus:outline-none focus:border-indigo-500 focus:bg-white transition-all title-font text-indigo-600 placeholder-slate-400 uppercase"
                maxlength="20"
                autocomplete="off"
            >

            <!-- Vibe Selector -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                <div class="relative">
                    <select id="vibeSelect" class="w-full appearance-none bg-white border-2 border-slate-300 rounded-xl px-4 py-3 text-lg focus:outline-none focus:border-pink-500 text-slate-700 font-bold cursor-pointer">
                        <option value="roast">âœ¨ Brutal Roast</option>
                        <option value="corporate">âœ¨ Corporate Speak</option>
                        <option value="scifi">âœ¨ Sci-Fi Technobabble</option>
                        <option value="motivational">âœ¨ Overly Motivational</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-slate-500">
                        <svg class="w-5 h-5 fill-current" viewBox="0 0 20 20"><path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/></svg>
                    </div>
                </div>
                
                <button 
                    id="generateBtn"
                    class="w-full bg-indigo-500 hover:bg-indigo-600 text-white text-xl py-3 rounded-xl border-b-4 border-indigo-700 active:border-b-0 active:translate-y-1 transition-all title-font wiggle flex items-center justify-center gap-2"
                >
                    <span>Reveal Truth!</span>
                </button>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="mt-8 hidden flex-col items-center justify-center py-4">
            <div class="w-12 h-12 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mb-4"></div>
            <p class="text-indigo-500 animate-pulse font-bold">Consulting the Oracle...</p>
        </div>

        <!-- Result Section -->
        <div id="resultContainer" class="mt-8 hidden">
            <div class="border-t-2 border-dashed border-slate-300 my-6"></div>
            <h2 class="text-center text-lg text-slate-400 mb-4">
                Here is what it <strong>actually</strong> means:
            </h2>
            
            <div id="acronymList" class="flex flex-wrap justify-center gap-3">
                <!-- Generated items go here -->
            </div>

            <!-- AI Definition Box -->
            <div id="aiDefinitionBox" class="hidden mt-6 bg-indigo-50 rounded-xl p-4 border-2 border-indigo-100 transform -rotate-1 shadow-sm">
                <!-- The ID "aiLabel" is used to target the label for translation -->
                <div id="aiLabel" class="text-sm font-bold text-indigo-500 mb-1">âœ¨ AI Analysis</div>
                <p id="aiDefinitionText" class="text-indigo-800 text-lg italic leading-snug">
                    <!-- Definition goes here -->
                </p>
            </div>

            <!-- Math Formula Box (Sci-Fi Only) -->
            <div id="mathBox" class="hidden mt-4 bg-slate-900 rounded-xl p-4 border-2 border-indigo-500 shadow-lg text-center overflow-x-auto">
                <div class="text-xs text-indigo-300 font-mono mb-2 uppercase tracking-widest">Calculated Probability</div>
                <div id="mathContent" class="text-white text-lg py-2"></div>
            </div>

            <div class="mt-8 flex justify-center gap-2">
                <button onclick="copyToClipboard()" class="text-sm bg-slate-200 hover:bg-slate-300 text-slate-700 px-4 py-2 rounded-lg transition-colors font-bold">
                    ðŸ“‹ Copy
                </button>
                <button onclick="handleGenerate()" class="text-sm bg-pink-100 hover:bg-pink-200 text-pink-700 px-4 py-2 rounded-lg transition-colors font-bold">
                    ðŸ”„ Re-roll
                </button>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div id="notification" class="fixed bottom-5 left-1/2 -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-lg transform transition-all duration-300 translate-y-20 opacity-0 z-50">
        Copied to clipboard!
    </div>

    <script>
        const apiKey = ""; // API key will be injected by the environment

        const input = document.getElementById('wordInput');
        const btn = document.getElementById('generateBtn');
        const vibeSelect = document.getElementById('vibeSelect');
        const resultContainer = document.getElementById('resultContainer');
        const acronymList = document.getElementById('acronymList');
        const loadingState = document.getElementById('loadingState');
        const aiDefinitionBox = document.getElementById('aiDefinitionBox');
        const aiDefinitionText = document.getElementById('aiDefinitionText');
        const aiLabel = document.getElementById('aiLabel');
        const mathBox = document.getElementById('mathBox');
        const mathContent = document.getElementById('mathContent');

        async function handleGenerate() {
            const text = input.value.trim();
            if (!text) {
                input.focus();
                return;
            }
            const mode = vibeSelect.value;
            await generateAIAcronym(text, mode);
        }

        function renderAcronym(letters, words, thaiWords = []) {
            // Clear previous results
            acronymList.innerHTML = '';
            resultContainer.classList.remove('hidden');
            loadingState.classList.add('hidden');

            letters.forEach((char, index) => {
                if (char.match(/[a-z]/i)) {
                    const word = words[index] || "???";
                    const thaiWord = thaiWords && thaiWords[index] ? thaiWords[index] : null;
                    
                    // Create item container
                    const item = document.createElement('div');
                    item.className = "flex flex-col items-center p-2 rounded-lg hover:bg-slate-50 transition-colors pop-in min-w-[90px]";
                    item.style.animationDelay = `${index * 100}ms`;
                    
                    // Letter Box
                    const letterBox = document.createElement('div');
                    letterBox.className = "w-10 h-10 flex items-center justify-center bg-slate-800 text-white rounded-lg title-font text-xl shadow-[3px_3px_0px_0px_rgba(160,174,192,1)] uppercase shrink-0 mb-2";
                    letterBox.textContent = char;
                    
                    // Word Container
                    const wordContainer = document.createElement('div');
                    wordContainer.className = "flex flex-col items-center text-center";
                    
                    // English Word
                    const wordText = document.createElement('div');
                    wordText.className = "text-lg text-indigo-600 title-font leading-tight";
                    wordText.textContent = word;
                    
                    wordContainer.appendChild(wordText);

                    // Thai Translation (if available)
                    if (thaiWord) {
                        const thaiText = document.createElement('div');
                        thaiText.className = "text-sm text-slate-400 font-normal mt-1";
                        thaiText.textContent = thaiWord;
                        wordContainer.appendChild(thaiText);
                    }

                    item.appendChild(letterBox);
                    item.appendChild(wordContainer);
                    acronymList.appendChild(item);
                } else if (char.trim() !== "") {
                    // Handle spaces/symbols
                    const spacer = document.createElement('div');
                    spacer.className = "w-4"; 
                    acronymList.appendChild(spacer);
                }
            });

             // Scroll to result on mobile
             if(window.innerWidth < 768) {
                setTimeout(() => {
                    resultContainer.scrollIntoView({ behavior: 'smooth' });
                }, 100);
            }
        }

        async function generateAIAcronym(text, vibe) {
            // UI Updates
            resultContainer.classList.add('hidden');
            loadingState.classList.remove('hidden');
            loadingState.classList.add('flex');
            mathBox.classList.add('hidden'); // Hide math box by default
            btn.disabled = true;
            
            try {
                const vibeMap = {
                    'roast': 'Savage Roast, insult the user, be rude but funny',
                    'corporate': 'Corporate Jargon, Synergistic, Meaningless Business Speak',
                    'scifi': 'Technobabble, Futuristic, Star Trek style. Use complex scientific sounding terms.',
                    'motivational': 'Overly Motivational, Toxic Positivity, Inspiring'
                };
                
                const styleDescription = vibeMap[vibe] || 'Funny';
                let latexInstruction = "";
                if (vibe === 'scifi') {
                    latexInstruction = `7. Since the style is Sci-Fi, generate a "latex_formula" that looks like a complex mathematical proof of this word. It should be readable (using valid LaTeX) but scientifically nonsensical and cool. Use integrals, sums, greek letters, etc. Return ONLY the raw latex string without markdown delimiters.`;
                }
                
                const systemPrompt = `You are a creative acronym generator.
                Task: Create a backronym for the word "${text}".
                Style/Vibe: ${styleDescription}.
                
                Rules:
                1. Break the word "${text}" down letter by letter.
                2. For each letter, assign a word starting with that letter.
                3. The words must form a coherent (but funny/absurd) phrase matching the vibe.
                4. Provide a witty "dictionary definition" or "deep thought" about this new phrase.
                5. Provide a Thai translation of that definition (SHORT, DIRECT translation only, no explanation).
                6. Provide Thai translations for each of the generated words.
                ${latexInstruction}
                
                Return ONLY valid JSON in this format:
                {
                    "words": ["WordForFirstLetter", "WordForSecondLetter", ...],
                    "words_thai": ["ThaiWord1", "ThaiWord2", ...],
                    "definition": "A short, witty explanation of this new concept.",
                    "definition_thai": "Direct, short Thai translation of the definition (max 1 sentence).",
                    "latex_formula": "Optional latex string (only if requested)"
                }
                `;

                // API Call
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: systemPrompt }]
                        }],
                        generationConfig: {
                            responseMimeType: "application/json"
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error('API Error');
                }

                const data = await response.json();
                const aiResult = JSON.parse(data.candidates[0].content.parts[0].text);

                // Process Results
                const chars = text.split('');
                const displayWords = [];
                const displayThaiWords = [];
                let aiWordIndex = 0;

                chars.forEach(char => {
                    if (char.match(/[a-z]/i)) {
                        displayWords.push(aiResult.words[aiWordIndex] || "Mystery");
                        displayThaiWords.push(aiResult.words_thai ? aiResult.words_thai[aiWordIndex] : "");
                        aiWordIndex++;
                    } else {
                        displayWords.push(null);
                        displayThaiWords.push(null);
                    }
                });

                // Render
                renderAcronym(chars, displayWords, displayThaiWords);
                
                // Show Definition & Translation
                if (aiResult.definition) {
                    aiDefinitionText.textContent = aiResult.definition;
                    
                    if (aiResult.definition_thai) {
                        aiLabel.textContent = 'âœ¨ ' + aiResult.definition_thai;
                        aiLabel.classList.remove('uppercase', 'tracking-wider', 'text-xs');
                        aiLabel.classList.add('text-sm', 'font-bold');
                    } else {
                        aiLabel.textContent = 'âœ¨ AI Analysis';
                        aiLabel.classList.add('uppercase', 'tracking-wider', 'text-xs');
                        aiLabel.classList.remove('text-sm');
                    }
                    
                    aiDefinitionBox.classList.remove('hidden');
                }

                // Render Math for Sci-Fi
                if (vibe === 'scifi' && aiResult.latex_formula) {
                    mathBox.classList.remove('hidden');
                    try {
                        // Clean up potential markdown delimiters from AI
                        let cleanFormula = aiResult.latex_formula
                            .replace(/^```latex\s*/, '')
                            .replace(/^```\s*/, '')
                            .replace(/```$/, '');
                            
                        if (window.katex) {
                            katex.render(cleanFormula, mathContent, {
                                throwOnError: false,
                                displayMode: true,
                                output: 'html' // Render as HTML elements
                            });
                        } else {
                            mathContent.textContent = cleanFormula;
                            console.error("KaTeX library not found");
                        }
                    } catch (e) {
                        console.error("KaTeX error", e);
                        mathBox.classList.add('hidden');
                    }
                }

            } catch (error) {
                console.error("AI Generation failed:", error);
                alert("The AI encountered an anomaly. Try again!");
            } finally {
                loadingState.classList.add('hidden');
                loadingState.classList.remove('flex');
                btn.disabled = false;
            }
        }

        // Event Listeners
        btn.addEventListener('click', handleGenerate);
        
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleGenerate();
        });

        function copyToClipboard() {
            const items = acronymList.querySelectorAll('.flex-col'); 
            let textToCopy = `The Truth about ${input.value.toUpperCase()}:\n\n`;
            
            const wordItems = Array.from(items).filter(item => item.querySelector('.text-indigo-600'));

            wordItems.forEach(item => {
                const letter = item.children[0].textContent;
                const wordContainer = item.children[1];
                const engWord = wordContainer.children[0].textContent;
                const thaiWord = wordContainer.children[1] ? ` (${wordContainer.children[1].textContent})` : '';
                textToCopy += `${letter} - ${engWord}${thaiWord}\n`;
            });

            if (!aiDefinitionBox.classList.contains('hidden')) {
                textToCopy += `\nAnalysis: ${aiDefinitionText.textContent}`;
                if (aiLabel.textContent.includes('âœ¨')) {
                    textToCopy += `\n(${aiLabel.textContent.replace('âœ¨ ', '')})`;
                }
            }
            
            if (!mathBox.classList.contains('hidden')) {
                 textToCopy += `\nEquation: [View App for Formula]`;
            }

            const textarea = document.createElement('textarea');
            textarea.value = textToCopy;
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                showNotification();
            } catch (err) {
                console.error('Failed to copy text', err);
            }
            
            document.body.removeChild(textarea);
        }

        function showNotification() {
            const notif = document.getElementById('notification');
            notif.classList.remove('translate-y-20', 'opacity-0');
            
            setTimeout(() => {
                notif.classList.add('translate-y-20', 'opacity-0');
            }, 2000);
        }
    </script>
</body>
</html>